<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <script src="index.js"></script>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <h1>US Colleges Data Visualization</h1>
    <svg id="my_usmap" width="880" height="600"></svg>

    <script>

        var campuses = d3.csv("campuses.csv")

        // The svg
        var svg = d3.select("svg"),
            width = +svg.attr("width"),
            height = +svg.attr("height");

        // Map and projection
        var projection = d3.geoAlbersUsa()
            .scale(980)                       // This is like the zoom
            .translate([width / 2, height / 2])

        // Load external data and boot
        d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson", function (data) {


            // Filter data
            data.features = data.features.filter(function (d) { console.log(d.properties.name); return d.properties.name == "USA" })

            // Draw the map
            svg.append("g")
                .selectAll("path")
                .data(data.features)
                .enter()
                .append("path")
                .attr("fill", "grey")
                .attr("d", d3.geoPath()
                    .projection(projection)
                )
                .style("stroke", "none")

            sjsu = {name: "sjsu", coordinates: [-121.8811, 37.3]};
            ucb = {name: "ucb", coordinates: [-122.2585, 37.8719]};
            ohiost = {name: "ohiost", coordinates: [-83.0305, 40.0067]};
            pitt = {name: "pitt", coordinates: [-79.9608, 40.4444]};
            chi = {name: "chi", coordinates: [-87.5987, 41.7886]};
            sea = {name: "sea", coordinates: [-122.303200, 47.655548]};

            console.log(projection(sjsu));
            console.log(projection(ucb))

            svg.selectAll("circle")
                .data([sjsu, ucb, ohiost, pitt, chi, sea]).enter()
                .append("circle")
                .attr("cx", function (d) { console.log(projection(d.coordinates)); return projection(d.coordinates)[0]; })
                .attr("cy", function (d) { return projection(d.coordinates)[1]; })
                .attr("id", function (d) { return d.name } )
                .attr("r", "4px")
                .attr("fill", "red")
                .on("mouseover", mouseOverHandler)
                .on("mouseout", mouseOutHandler)
                .on("click", clickHandler);
        })

        var pieWidth = 600;
        var pieHeight = 500;
        var colors = d3.scaleOrdinal(d3.schemeDark2)
            var pieChart = d3.select("body").append("svg")
                .attr("width", pieWidth).attr("height", pieHeight)
                .style("background", "blue");
            var details = [{race: "Asian", pct: 39},
                        {race: "Latino", pct: 32}, 
                        {race: "White", pct: 15},
                        {race: "Black/African American", pct: 4},
                        {race: "Other/Unknown/Mixed Race (Not Latino)", pct: 10}]
            var data = d3.pie().sort(null).value(function(d){return d.pct})(details);
            console.log(data);
            var segments = d3.arc()
                                .innerRadius(0)
                                .outerRadius(200)
                                .padAngle(.05)
                                data
            sections.enter().append("path").attr("d", segments).attr("fill", 
            function(d){return colors(d.data.pct)})

            var content = d3.select("g").selectAll("text").data(data);
            content.enter().append("text").each(function(d){
                var center = segments.centroid(d);
                d3.select(this).attr("x", center[0]).attr("y", center[1])
                .text(`${d.data.pct}%`)
            });

            var legends = pieChart.append("g").attr("transform", "translate(500, 100)")
                            .selectAll(".legends").data(data);
            var legend = legends.enter().append("g").classed("legends", true)
                            .attr("transform", function(d, i){return "translate(0," + (i+1)*30 + ")";});
                            legend.append("rect").attr("width", 20).attr("height", 20).attr("fill",
                            function(d){return colors(d.data.pct);});
                                legend.append("text").text(function(d){return d.data.race;})
                                    .attr("fill", function(d){return colors(d.data.pct)})
                                    .attr("x", 30)
                                    .attr("y", 20);
                                    
                            
            
    </script>

    <div class="sjsu" >
            <img src="../assets/sjsu_logo.gif" alt="">
            <h3>San Jose State University</h3>
            <ul>
                <li>Undergraduate Population: 27,702</li>
                <li>International Students: 3,333</li>
                <li>International Grad Students: 1,250</li>
            </ul>
    </div>

    <div class="ucb">
        <h3>University of California, Berkeley</h3>
    </div>

    <div class="ohiost">
        <h3>Ohio State University</h3>
    </div>

    <div class="pitt">
        <h3>University of Pittsburgh</h3>
    </div>

    <div class="chi">
        <h3>University of Chicago</h3>
    </div>

    <div class="sea">
        <h3>University of Washington</h3>
    </div>
    


</body>
</html>